From 03adbea28855a7f4397692e621e1066046963b75 Mon Sep 17 00:00:00 2001
From: gesangtome <gesangtome@foxmail.com>
Date: Sat, 22 Feb 2020 09:04:25 +0800
Subject: [PATCH] audio: Fix build  problems

Change-Id: I62b8f85339e64a7692b53d6078ccabb31dbd5488
---
 0001-audio-Fix-compilation-error.patch | 38 ++++++++++++++++++++++++++
 hal/Android.mk                         |  7 +++--
 hal/platform_info.c                    |  3 --
 3 files changed, 43 insertions(+), 5 deletions(-)
 create mode 100644 0001-audio-Fix-compilation-error.patch

diff --git a/0001-audio-Fix-compilation-error.patch b/0001-audio-Fix-compilation-error.patch
new file mode 100644
index 00000000..e71c2949
--- /dev/null
+++ b/0001-audio-Fix-compilation-error.patch
@@ -0,0 +1,38 @@
+From 3dcbc6e5cfaef9fd80ef28a3ec3bdd994aee8ba9 Mon Sep 17 00:00:00 2001
+From: gesangtome <gesangtome@foxmail.com>
+Date: Wed, 25 Dec 2019 20:47:10 +0800
+Subject: [PATCH] audio: Fix compilation error
+
+Change-Id: I62b8f85339e64a7692b53d6078ccabb31dbd5488
+---
+ hal/Android.mk | 7 +++++--
+ 1 file changed, 5 insertions(+), 2 deletions(-)
+
+diff --git a/hal/Android.mk b/hal/Android.mk
+index 5fb332292..88f6cfe77 100644
+--- a/hal/Android.mk
++++ b/hal/Android.mk
+@@ -370,8 +370,6 @@ LOCAL_MODULE_OWNER := qti
+ 
+ LOCAL_VENDOR_MODULE := true
+ 
+-include $(BUILD_SHARED_LIBRARY)
+-
+ LOCAL_CFLAGS += -Wno-unused-variable
+ LOCAL_CFLAGS += -Wno-sign-compare
+ LOCAL_CFLAGS += -Wno-unused-parameter
+@@ -382,6 +380,11 @@ LOCAL_CFLAGS += -Wno-shorten-64-to-32
+ LOCAL_CFLAGS += -Wno-tautological-compare
+ LOCAL_CFLAGS += -Wno-unused-function
+ LOCAL_CFLAGS += -Wno-unused-local-typedef
++LOCAL_CFLAGS += -Wno-implicit-function-declaration
++LOCAL_CFLAGS += -Wno-incompatible-pointer-types-discards-qualifiers
++LOCAL_CFLAGS += -Wno-format
++
++include $(BUILD_SHARED_LIBRARY)
+ 
+ endif
+ endif
+-- 
+2.24.1
+
diff --git a/hal/Android.mk b/hal/Android.mk
index de04e527..bbfba8b1 100644
--- a/hal/Android.mk
+++ b/hal/Android.mk
@@ -375,8 +375,6 @@ LOCAL_MODULE_OWNER := qti
 
 LOCAL_VENDOR_MODULE := true
 
-include $(BUILD_SHARED_LIBRARY)
-
 LOCAL_CFLAGS += -Wno-unused-variable
 LOCAL_CFLAGS += -Wno-sign-compare
 LOCAL_CFLAGS += -Wno-unused-parameter
@@ -387,6 +385,11 @@ LOCAL_CFLAGS += -Wno-shorten-64-to-32
 LOCAL_CFLAGS += -Wno-tautological-compare
 LOCAL_CFLAGS += -Wno-unused-function
 LOCAL_CFLAGS += -Wno-unused-local-typedef
+LOCAL_CFLAGS += -Wno-implicit-function-declaration
+LOCAL_CFLAGS += -Wno-incompatible-pointer-types-discards-qualifiers
+LOCAL_CFLAGS += -Wno-format
+
+include $(BUILD_SHARED_LIBRARY)
 
 endif
 endif
diff --git a/hal/platform_info.c b/hal/platform_info.c
index 1969f52e..d73792c5 100644
--- a/hal/platform_info.c
+++ b/hal/platform_info.c
@@ -135,7 +135,6 @@ struct platform_info {
 };
 
 static struct platform_info my_data;
-static pthread_mutex_t parser_lock = PTHREAD_MUTEX_INITIALIZER;
 
 
 struct audio_string_to_enum {
@@ -1448,7 +1447,6 @@ int platform_info_init(const char *filename, void *platform, caller_t caller_typ
     void            *buf;
     char            platform_info_file_name[MIXER_PATH_MAX_LENGTH]= {0};
 
-    pthread_mutex_lock(&parser_lock);
     if (filename == NULL)
         strlcpy(platform_info_file_name, PLATFORM_INFO_XML_PATH,
                 MIXER_PATH_MAX_LENGTH);
@@ -1513,6 +1511,5 @@ err_free_parser:
 err_close_file:
     fclose(file);
 done:
-    pthread_mutex_unlock(&parser_lock);
     return ret;
 }
-- 
2.24.1

